<html>
  <head>
    <title>WBHB Studio Live</title>
    
    <link rel="manifest" href="./manifest.json" crossorigin="use-credentials">
    
    <link rel="icon" sizes="192x192" href="./static/images/logo_new.png">
    
    <script type="module" src='./lib/ui/wbhb-button.js'></script>
    <script type="module" src='./lib/ui/wbhb-adjust-tempo.js'></script>
    <script type="module" src='./lib/ui/wbhb-chord.js'></script>
    <script type="module" src='./lib/ui/wbhb-sequencer.js'></script>
    <script type="module" src='./lib/ui/wbhb-sequencer-track.js'></script>
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
      
      html {
        
        --wbhb-color-yellow: #fedb00;
        --wbhb-color-yellow-trans: #fedb0040;
        --wbhb-color-grey: #53565A;
        --wbhb-color-grey-trans: #53565A80;
        --wbhb-color-black: #000000;
        --wbhb-color-white: #ffffff;
        --wbhb-font-heading: "Ubuntu", sans-serif;
        --wbhb-font-body: "Cala Light", serif;
        
        --grid-size: 15vw;
        --grid-gap: 5vw;
      }
      
      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        
        overflow-x: hidden;
        
        font-family: var(--wbhb-font-heading);
        background-color: var(--wbhb-color-black);
        color: var(--wbhb-color-white);
      }
      
      #controls {
        margin: 2.5vw;
        padding: 0;
        width: 95vw;
        display: grid;
        grid-template-columns: repeat(5, var(--grid-size));
        grid-auto-rows: var(--grid-size);
        grid-gap: var(--grid-gap);
      }
      
      #logo {
        font-size: 24pt;
        display: inline-flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        grid-column: span 2;
        width: calc(calc(2 * var(--grid-size)) + var(--grid-gap));
      }
      
      #logo h1 {
        font-size: 36pt;
        margin-bottom: -18pt;
      }
      
      #logo h2 {
        font-size: 18pt;
        color: var(--wbhb-color-grey);
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <div id="logo">
        <h1>Studio Live</h1>
        <h2>By WearsBlackHasBeard</h2>
      </div>
      
      <wbhb-button name="Start"></wbhb-button>
      <wbhb-button name="Stop" draggable="true"></wbhb-button>
      
      
      <wbhb-button type="connect" name="MIDI"></wbhb-button>
      
      <wbhb-button name="Time" type="Preset">
        <wbhb-button type="Time" name="2/2" draggable="true"></wbhb-button>
        <wbhb-button type="Time" name="?/4">
          <wbhb-button type="Time" name="2/4" draggable="true"></wbhb-button>
          <wbhb-button type="Time" name="3/4" draggable="true"></wbhb-button>
          <wbhb-button type="Time" name="4/4" draggable="true"></wbhb-button>
          <wbhb-button type="Time" name="5/4" draggable="true"></wbhb-button>
        </wbhb-button>
        <wbhb-button type="Time" name="6/8" draggable="true"></wbhb-button>
      </wbhb-button>
      <wbhb-adjust-tempo>
        <wbhb-button name="Tempo" type="Preset">
          <wbhb-button type="BPM" name="54" draggable="true"></wbhb-button>
          <wbhb-button type="BPM" name="60" draggable="true"></wbhb-button>
          <wbhb-button type="BPM" name="90" draggable="true"></wbhb-button>
          <wbhb-button type="BPM" name="120" draggable="true"></wbhb-button>
          <wbhb-button type="BPM" name="160" draggable="true"></wbhb-button>
        </wbhb-button>
      </wbhb-adjust-tempo>
      
      <wbhb-button name="Death was Arrested" type="Song" wide></wbhb-button>
      
      <wbhb-button type="Prompt" name="Bridge" draggable="true">
        <wbhb-button type="Prompt" name="Bridge 1" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Bridge 2" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Bridge 3" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Bridge 4" draggable="true"></wbhb-button>
      </wbhb-button>
      <wbhb-button type="Prompt" name="Chorus" draggable="true">
        <wbhb-button type="Prompt" name="Pre Chorus" draggable="true">
          <wbhb-button type="Prompt" name="Pre Chorus 1" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Pre Chorus 2" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Pre Chorus 3" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Pre Chorus 4" draggable="true"></wbhb-button>
        </wbhb-button>
        <wbhb-button type="Prompt" name="Chorus 1" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Chorus 2" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Chorus 3" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Chorus 4" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Post Chorus" draggable="true"></wbhb-button>
      </wbhb-button>
      <wbhb-button type="Prompt" name="Verse" draggable="true">
        <wbhb-button type="Prompt" name="Verse 1" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 2" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 3" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 4" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 5" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 6" draggable="true"></wbhb-button>
      </wbhb-button>
      <wbhb-button type="Prompt" name="More">
        <wbhb-button type="Prompt" name="Intro" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Outro" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Ending" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Betweens">
          <wbhb-button type="Prompt" name="Interlude" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Turnaround" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Instrumental" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Acapella" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Breakdown" draggable="true"></wbhb-button>
        </wbhb-button>
        <wbhb-button type="Prompt" name="Specials">
          <wbhb-button type="Prompt" name="Exhortation" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Rap" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Tag" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Refrain" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Solo" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Vamp" draggable="true"></wbhb-button>
        </wbhb-button>
      </wbhb-button>
      
      <wbhb-button type="" name="Drums">
        <wbhb-button type="Drum Kit" name="CarbonMonoxide" href="http://ccmixter.org/files/carbonmonoxidemusic/23425">
          <wbhb-button type="Hit" name="Closed Hat" href="static/audio/drums/CO/ClosedHat.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Crash" href="static/audio/drums/CO/CrashCymbal.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Floor Tom" href="static/audio/drums/CO/FloorTom.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Kick" href="static/audio/drums/CO/Kick.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Mid Hat" href="static/audio/drums/CO/MidHat.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Mid Tom" href="static/audio/drums/CO/MidTom.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Open Hat 1" href="static/audio/drums/CO/OpenHat1.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Open Hat 2" href="static/audio/drums/CO/OpenHat2.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Ride" href="static/audio/drums/CO/RideCymbal.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Sample 1" href="static/audio/drums/CO/Sample1.wav" draggable="true"></wbhb-button>
          <wbhb-button type="Hit" name="Sample 2" href="static/audio/drums/CO/Sample2.wav" draggable="true"></wbhb-button>
        </wbhb-button>
      </wbhb-button>
      
      <wbhb-button type="" name="Chords">
        <wbhb-button type="Major" name="Root" draggable="true"></wbhb-button>
        <wbhb-button type="Major" name="Forth" draggable="true"></wbhb-button>
        <wbhb-button type="Major" name="Fifth" draggable="true"></wbhb-button>
        <wbhb-button type="Minor" name="Sixth" draggable="true"></wbhb-button>
        <wbhb-button type="More" name="Common">
          <wbhb-button type="Major" name="Second" draggable="true"></wbhb-button>
          <wbhb-button type="Minor" name="Third" draggable="true"></wbhb-button>
          <wbhb-button type="Major" name="Seventh" draggable="true"></wbhb-button>
          <wbhb-button type="Minor" name="Seventh" draggable="true"></wbhb-button>
        </wbhb-button>
        <wbhb-button type="More" name="Modifiers">
          <wbhb-button type="Modifier" name="Sus" draggable="true"></wbhb-button>
          <wbhb-button type="Modifier" name="2" draggable="true"></wbhb-button>
          <wbhb-button type="Modifier" name="4" draggable="true"></wbhb-button>
          <wbhb-button type="Modifier" name="Minor" draggable="true"></wbhb-button>
        </wbhb-button>
      </wbhb-button>
      
      <!--<wbhb-chord></wbhb-chord>-->
    </div>
    
    <wbhb-sequencer filters="ChordItem PromptItem *">
      
    </wbhb-sequencer>

    <script type="module">
      import {Scheduler, CONTROL_CODES as SCHEDULER_CONTROL_CODES} from './lib/scheduler/scheduler.js';
      import {Metronome} from './lib/sequencer/metronome.js';
      import {ItemDB} from './lib/sequencer/items/ItemDB.js';
      import {SequencerItem} from './lib/sequencer/items/SequencerItem.js';
      import {SectionItem} from './lib/sequencer/items/SectionItem.js';
      import {ControlCode, ControlItem} from './lib/sequencer/items/ControlItem.js';
      import {PromptItem} from './lib/sequencer/items/PromptItem.js';
      import {CachedAudioItem} from './lib/sequencer/items/CachedAudioItem.js';
      import {ChordItem} from './lib/sequencer/items/ChordItem.js';
      import {MIDIItem} from './lib/sequencer/items/MIDIItem.js';
      import {TimeSignature} from './lib/util/timeSignature.js';
      import {Prompts} from './lib/sequencer/prompts.js';
      import {Drums} from './lib/sequencer/drums.js';
      import {MIDISequencer} from './lib/sequencer/MIDISequencer.js';
      import {Chord} from './lib/util/chords.js';
      import {Length} from './lib/util/length.js';
      import {MIDI} from './lib/util/midi.js';
      import {MIDIRemap} from './lib/util/midiRemap.js';
      import {DrumKit} from './lib/instrument/DrumKit.js';
      import {SynthInstrument as Synth} from './lib/instrument/SynthInstrument.js';
      // import {SongSheetSequencer} from './lib/sequencer/songSheetSequencer.js';
      
      const AudioContext = window.AudioContext || window.webkitAudioContext;

      if (!AudioContext) {
        throw new Error("WebAudio not supported");
      }
      
      console.log(0);
      
      const metronome = new Metronome();
      const prompt = new Prompts();
      const drums = new Drums();
      const midiSequencer = new MIDISequencer();
      
      const kit = fetch('static/audio/drums/CO/init.json').then(response => response.json()).then(DrumKit.create).then((kit) => {kit.midiChannel = 9; return kit}).catch('Error creating drumkit');
      
      console.log(1);
      
      const metronomeInstrument = fetch('static/audio/drums/Metronome/init.json').then(response => response.json()).then(DrumKit.create).then((kit) => {kit.midiChannel = -1; return kit}).catch('Error creating metronome');
      
      console.log(2);
      
      const synth = new Synth();
      
      const kick = {
        channel: 9,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_On,
        note: 36,
        velocity: 127
      };
      
      const k1 = await ItemDB.set(new MIDIItem({
        message: kick,
        timings: {
          offset: new Length(0, Length.units.beat)
        }
      }));
      const k2 = await ItemDB.set(new MIDIItem({
        message: kick,
        timings: {
          offset: new Length(1, Length.units.beat)
        }
      }));
      const k3 = await ItemDB.set(new MIDIItem({
        message: kick,
        timings: {
          offset: new Length(2.5, Length.units.beat)
        }
      }));
      const k4 = await ItemDB.set(new MIDIItem({
        message: kick,
        timings: {
          offset: new Length(3, Length.units.beat)
        }
      }));
      
      const kickBar = await ItemDB.set(new SectionItem({
        itemIds: [k1, k2, k3, k4],
        repeats: 0,
        timings: {
          offset: new Length(0, Length.units.beat)
        }
      }));
      
      const C3_on = {
        channel: 0,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_On,
        note: 36,
        velocity: 127
      };
      
      const C3_off = {
        channel: 0,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_Off,
        note: 36,
        velocity: 127
      };
      
      const Cs3_on = {
        channel: 0,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_On,
        note: 37,
        velocity: 127
      };
      
      const Cs3_off = {
        channel: 0,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_Off,
        note: 37,
        velocity: 127
      };
      
      const B3_on = {
        channel: 0,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_On,
        note: 35,
        velocity: 127
      };
      
      const B3_off = {
        channel: 0,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_Off,
        note: 35,
        velocity: 127
      };
      
      const Bb3_on = {
        channel: 0,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_On,
        note: 34,
        velocity: 127
      };
      
      const Bb3_off = {
        channel: 0,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_Off,
        note: 34,
        velocity: 127
      };
      
      const s1n = await ItemDB.set(new MIDIItem({
        message: C3_on,
        timings: {
          offset: new Length(0, Length.units.beat)
        }
      }));
      const s1f = await ItemDB.set(new MIDIItem({
        message: C3_off,
        timings: {
          offset: new Length(1.4, Length.units.beat)
        }
      }));
      const s2n = await ItemDB.set(new MIDIItem({
        message: C3_on,
        timings: {
          offset: new Length(1.5, Length.units.beat)
        }
      }));
      const s2f = await ItemDB.set(new MIDIItem({
        message: C3_off,
        timings: {
          offset: new Length(1.9, Length.units.beat)
        }
      }));
      const s3n = await ItemDB.set(new MIDIItem({
        message: C3_on,
        timings: {
          offset: new Length(2, Length.units.beat)
        }
      }));
      const s3f = await ItemDB.set(new MIDIItem({
        message: C3_off,
        timings: {
          offset: new Length(2.4, Length.units.beat)
        }
      }));
      
      const s4an = await ItemDB.set(new MIDIItem({
        message: Bb3_on,
        timings: {
          offset: new Length(2.5, Length.units.beat)
        }
      }));
      const s4af = await ItemDB.set(new MIDIItem({
        message: Bb3_off,
        timings: {
          offset: new Length(3.4, Length.units.beat)
        }
      }));
      const s5an = await ItemDB.set(new MIDIItem({
        message: Bb3_on,
        timings: {
          offset: new Length(3.5, Length.units.beat)
        }
      }));
      const s5af = await ItemDB.set(new MIDIItem({
        message: Bb3_off,
        timings: {
          offset: new Length(3.9, Length.units.beat)
        }
      }));
      
      const s4bn = await ItemDB.set(new MIDIItem({
        message: Cs3_on,
        timings: {
          offset: new Length(2.5, Length.units.beat)
        }
      }));
      const s4bf = await ItemDB.set(new MIDIItem({
        message: Cs3_off,
        timings: {
          offset: new Length(3.4, Length.units.beat)
        }
      }));
      const s5bn = await ItemDB.set(new MIDIItem({
        message: Cs3_on,
        timings: {
          offset: new Length(3.5, Length.units.beat)
        }
      }));
      const s5bf = await ItemDB.set(new MIDIItem({
        message: Cs3_off,
        timings: {
          offset: new Length(3.9, Length.units.beat)
        }
      }));
      
      const synthLine = await ItemDB.set(new SectionItem({
        itemIds: [
          [s1n, s1f, s2n, s2f, s3n, s3f, s4an, s4af, s5an, s5af],
          [s1n, s1f, s2n, s2f, s3n, s3f, s4bn, s4bf, s5bn, s5bf]
        ],
        repeats: 0,
        timings: {
          offset: new Length(0, Length.units.beat)
        }
      }));
      
      midiSequencer.items = [[kickBar, synthLine]];
      
      const sequencerEl = document.querySelector('wbhb-sequencer');
      
      prompt.items = sequencerEl.items;
      drums.items = sequencerEl.items;
      
      // sequencerEl.addEventListener('control-play', () => {
      //   Scheduler.GLOBAL.audioContext = new AudioContext();
      //   let start = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.START});
      //   Scheduler.GLOBAL.dispatchEvent(start);
      // });
      
      // sequencerEl.addEventListener('control-stop', () => {
      //   let stop = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.STOP});
      //   Scheduler.GLOBAL.scheduleItem(stop);
      // });
      
      
      document.querySelector('wbhb-button[name="Start"]').addEventListener('click', () => {
        if (!Scheduler.GLOBAL.audioContext) {
          Scheduler.GLOBAL.audioContext = new AudioContext();
        }
        // let start = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.START});
        // Scheduler.GLOBAL.dispatchEvent(start);
        Scheduler.GLOBAL.start();
      });
      
      document.querySelector('wbhb-button[name="Stop"]').addEventListener('click', () => {
        let stop = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.STOP});
        Scheduler.GLOBAL.scheduleItem(stop);
      });
      
      document.querySelector('wbhb-adjust-tempo').tempo.addEventListener('change', (e) => {
        let item = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.TEMPO});
        item.payload = document.querySelector('wbhb-adjust-tempo').tempo;
        Scheduler.GLOBAL.scheduleItem(item);
      });
      
      document.querySelectorAll('wbhb-button[type="Time"]').forEach((node) => {
        const parts = node.getAttribute('name').split('/');
        const upper = Number.parseInt(parts[0], 10);
        const lower = Number.parseInt(parts[1], 10);
        if (upper && lower) {
          node.addEventListener('click', () => {
            let item = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.TIME_SIGNATURE});
            item.payload = new TimeSignature(upper, lower);
            Scheduler.GLOBAL.dispatchEvent(item);
          });
        }
      });
      
      document.querySelectorAll('wbhb-button[type="Prompt"]').forEach((node) => {
        const name = node.getAttribute('name');
        node.addEventListener('click', () => {
          let item = new PromptItem({timings: {immediate: true}, count: true});
          item.add(name);
          Scheduler.GLOBAL.dispatchEvent(item);
        });
      });
      
      document.querySelectorAll('wbhb-button[name="Chords"] wbhb-button:not([type="More"]):not([type="Modifier"])').forEach((node) => {
        const name = node.getAttribute('name');
        const type = node.getAttribute('type');
        
        let item = new ChordItem({timings: {length: {unit: 'beat', value: 1}}});
        let chord = new Chord(name);
        chord = chord.setQuality(type);
        item.chord = chord;
        node.item = item;
        
        node.addEventListener('click', () => {
          let item = new ChordItem({...node.item, ...{timings: {immediate: true}}});
          Scheduler.GLOBAL.dispatchEvent(item);
        });
      });
      
      document.querySelectorAll('wbhb-button[type="Prompt"]').forEach((node) => {
        const name = node.getAttribute('name');
        const type = node.getAttribute('type');
        
        let item = new PromptItem({timings: {length: {unit: 'beat', value: 1}}});
        node.item = item;
        
        node.addEventListener('click', () => {
          let item = new PromptItem({...node.item, ...{timings: {immediate: true}}});
          Scheduler.GLOBAL.dispatchEvent(item);
        });
      });
      
      document.querySelectorAll('wbhb-button[type="Hit"]').forEach((node) => {
        const name = node.getAttribute('name');
        
        let item = new CachedAudioItem({cacheKey: name, timings: {length: {unit: 'beat', value: 1}}});
        node.item = item;
        
        node.addEventListener('click', () => {
          let item = new CachedAudioItem({...node.item, ...{cacheKey: node.item.cacheKey, timings: {immediate: true}}});
          Scheduler.GLOBAL.dispatchEvent(item);
        });
      });
      
      Scheduler.GLOBAL.addEventListener("nextBar", (e) => {
        
        const sequencer = document.querySelector("wbhb-sequencer");
        
        sequencer.currentBar = e.barNumber;
      });
      
      document.querySelectorAll('wbhb-button[name="MIDI"]').forEach((node) => {
        
        const midiSetup = () => {
          const midiContext = new MIDI();
          
          // const synth = new Synth();
          
          node.removeEventListener('click', midiSetup);
          
          node.setAttribute('disabled', '');
          
          const AlesisV25_drumRemap = new MIDIRemap([
            {
              "tests": [
                {
                  "inputParam": "channel",
                  "testMode": "=",
                  "testValue": 9
                },
                {
                  "inputParam": "method",
                  "testMode": "=",
                  "testValue": MIDI.Channel_Voice
                },
                {
                  "inputParam": "note",
                  "testMode": "=",
                  "testValue": 36
                }
              ],
              "map": {
                "mapMode": "=",
                "mapValue": DrumKit.getNoteNumber('Closed Hi-hat'),
                "outputParam": "note"
              }
            },
            {
              "tests": [
                {
                  "inputParam": "channel",
                  "testMode": "=",
                  "testValue": 9
                },
                {
                  "inputParam": "method",
                  "testMode": "=",
                  "testValue": MIDI.Channel_Voice
                },
                {
                  "inputParam": "note",
                  "testMode": "=",
                  "testValue": 37
                }
              ],
              "map": {
                "mapMode": "=",
                "mapValue": DrumKit.getNoteNumber('Bass Drum 1'),
                "outputParam": "note"
              }
            },
            {
              "tests": [
                {
                  "inputParam": "channel",
                  "testMode": "=",
                  "testValue": 9
                },
                {
                  "inputParam": "method",
                  "testMode": "=",
                  "testValue": MIDI.Channel_Voice
                },
                {
                  "inputParam": "note",
                  "testMode": "=",
                  "testValue": 38
                }
              ],
              "map": {
                "mapMode": "=",
                "mapValue": DrumKit.getNoteNumber('Snare Drum 1'),
                "outputParam": "note"
              }
            },
            {
              "tests": [
                {
                  "inputParam": "channel",
                  "testMode": "=",
                  "testValue": 9
                },
                {
                  "inputParam": "method",
                  "testMode": "=",
                  "testValue": MIDI.Channel_Voice
                },
                {
                  "inputParam": "note",
                  "testMode": "=",
                  "testValue": 39
                }
              ],
              "map": {
                "mapMode": "=",
                "mapValue": DrumKit.getNoteNumber('Low Tom 1'),
                "outputParam": "note"
              }
            }
          ]);
          
          midiContext.addEventListener('midi-message', (e) => {
            let item = new MIDIItem({
              message: AlesisV25_drumRemap.remap(e.message),
              timings: {
                immediate: true
              }
            });
          
            if (item) {
              Scheduler.GLOBAL.scheduleItem(item);
            }
            
          });
          
        };
        
        node.addEventListener('click', midiSetup);
      });
    </script>
  </body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>WBHB Studio Live</title>
    
    <link rel="manifest" href="./manifest.json" crossorigin="use-credentials">
    
    <link rel="icon" sizes="192x192" href="./static/images/logo_new.png">
    
    <script type="module" src='./lib/ui/wbhb-button.mjs'></script>
    <script type="module" src='./lib/ui/wbhb-adjust-tempo.mjs'></script>
    <script type="module" src='./lib/ui/wbhb-chord.mjs'></script>
    <script type="module" src='./lib/ui/wbhb-sequencer.mjs'></script>
    <script type="module" src='./lib/ui/wbhb-sequencer-track.mjs'></script>
    <script type="module" src='./lib/ui/wbhb-rack-connections.mjs'></script>
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script defer src="https://www.gstatic.com/firebasejs/8.2.4/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.2.4/firebase-analytics.js"></script>
    
    <style>
      
      html {
        
        --wbhb-color-yellow: #fedb00;
        --wbhb-color-yellow-trans: #fedb0040;
        --wbhb-color-grey: #53565A;
        --wbhb-color-grey-trans: #53565A80;
        --wbhb-color-black: #000000;
        --wbhb-color-white: #ffffff;
        --wbhb-font-heading: "Ubuntu", sans-serif;
        --wbhb-font-body: "Cala Light", serif;
        
        --grid-size: 15vw;
        --grid-gap: 5vw;
      }
      
      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        
        overflow-x: hidden;
        
        font-family: var(--wbhb-font-heading);
        background-color: var(--wbhb-color-black);
        color: var(--wbhb-color-white);
      }
      
      #controls {
        margin: 2.5vw;
        padding: 0;
        width: 95vw;
        display: grid;
        grid-template-columns: repeat(5, var(--grid-size));
        grid-auto-rows: var(--grid-size);
        grid-gap: var(--grid-gap);
      }
      
      #logo {
        font-size: 24pt;
        display: inline-flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        grid-column: span 2;
        width: calc(calc(2 * var(--grid-size)) + var(--grid-gap));
      }
      
      #logo h1 {
        font-size: 36pt;
        margin-bottom: -18pt;
      }
      
      #logo h2 {
        font-size: 18pt;
        color: var(--wbhb-color-grey);
      }
      
      #rack {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
      }
      
      #rack #connections {
        position: absolute;
        width: 100%;
        height: 100%;
      }
      
      #rack #sources {
        width: 20vw;
      }
      
      #rack #transforms {
        width: 30vw;
      }
      
      #rack #destinations {
        width: 20vw;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <div id="logo">
        <h1>Studio Live</h1>
        <h2>By WearsBlackHasBeard</h2>
      </div>
      
      <wbhb-button name="Start"></wbhb-button>
      <wbhb-button name="Stop" draggable="true"></wbhb-button>
      
      <wbhb-button name="Save"></wbhb-button>
      <wbhb-button name="Load"></wbhb-button>
      
      <wbhb-button name="Time" type="Preset">
        <wbhb-button type="Time" name="2/2" draggable="true"></wbhb-button>
        <wbhb-button type="Time" name="?/4">
          <wbhb-button type="Time" name="2/4" draggable="true"></wbhb-button>
          <wbhb-button type="Time" name="3/4" draggable="true"></wbhb-button>
          <wbhb-button type="Time" name="4/4" draggable="true"></wbhb-button>
          <wbhb-button type="Time" name="5/4" draggable="true"></wbhb-button>
        </wbhb-button>
        <wbhb-button type="Time" name="6/8" draggable="true"></wbhb-button>
      </wbhb-button>
      <wbhb-adjust-tempo>
        <wbhb-button name="Tempo" type="Preset">
          <wbhb-button type="BPM" name="54" draggable="true"></wbhb-button>
          <wbhb-button type="BPM" name="60" draggable="true"></wbhb-button>
          <wbhb-button type="BPM" name="90" draggable="true"></wbhb-button>
          <wbhb-button type="BPM" name="120" draggable="true"></wbhb-button>
          <wbhb-button type="BPM" name="160" draggable="true"></wbhb-button>
        </wbhb-button>
      </wbhb-adjust-tempo>
      
      <wbhb-button name="Death was Arrested" type="Song" wide></wbhb-button>
      
      <wbhb-button type="Prompt" name="Bridge" draggable="true">
        <wbhb-button type="Prompt" name="Bridge 1" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Bridge 2" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Bridge 3" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Bridge 4" draggable="true"></wbhb-button>
      </wbhb-button>
      <wbhb-button type="Prompt" name="Chorus" draggable="true">
        <wbhb-button type="Prompt" name="Pre Chorus" draggable="true">
          <wbhb-button type="Prompt" name="Pre Chorus 1" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Pre Chorus 2" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Pre Chorus 3" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Pre Chorus 4" draggable="true"></wbhb-button>
        </wbhb-button>
        <wbhb-button type="Prompt" name="Chorus 1" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Chorus 2" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Chorus 3" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Chorus 4" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Post Chorus" draggable="true"></wbhb-button>
      </wbhb-button>
      <wbhb-button type="Prompt" name="Verse" draggable="true">
        <wbhb-button type="Prompt" name="Verse 1" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 2" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 3" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 4" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 5" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Verse 6" draggable="true"></wbhb-button>
      </wbhb-button>
      <wbhb-button type="Prompt" name="More">
        <wbhb-button type="Prompt" name="Intro" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Outro" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Ending" draggable="true"></wbhb-button>
        <wbhb-button type="Prompt" name="Betweens">
          <wbhb-button type="Prompt" name="Interlude" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Turnaround" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Instrumental" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Acapella" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Breakdown" draggable="true"></wbhb-button>
        </wbhb-button>
        <wbhb-button type="Prompt" name="Specials">
          <wbhb-button type="Prompt" name="Exhortation" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Rap" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Tag" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Refrain" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Solo" draggable="true"></wbhb-button>
          <wbhb-button type="Prompt" name="Vamp" draggable="true"></wbhb-button>
        </wbhb-button>
      </wbhb-button>
      
      <wbhb-button type="" name="Drums"></wbhb-button>
      
      <wbhb-button type="" name="Chords">
        <wbhb-button type="Major" name="Root" draggable="true"></wbhb-button>
        <wbhb-button type="Major" name="Forth" draggable="true"></wbhb-button>
        <wbhb-button type="Major" name="Fifth" draggable="true"></wbhb-button>
        <wbhb-button type="Minor" name="Sixth" draggable="true"></wbhb-button>
        <wbhb-button type="More" name="Common">
          <wbhb-button type="Major" name="Second" draggable="true"></wbhb-button>
          <wbhb-button type="Minor" name="Third" draggable="true"></wbhb-button>
          <wbhb-button type="Major" name="Seventh" draggable="true"></wbhb-button>
          <wbhb-button type="Minor" name="Seventh" draggable="true"></wbhb-button>
        </wbhb-button>
        <wbhb-button type="More" name="Modifiers">
          <wbhb-button type="Modifier" name="Sus" draggable="true"></wbhb-button>
          <wbhb-button type="Modifier" name="2" draggable="true"></wbhb-button>
          <wbhb-button type="Modifier" name="4" draggable="true"></wbhb-button>
          <wbhb-button type="Modifier" name="Minor" draggable="true"></wbhb-button>
        </wbhb-button>
      </wbhb-button>
    </div>
    
    <wbhb-sequencer media-types="application/x.wbhb.studio.midiitem">
      
    </wbhb-sequencer>
    
    <div id="rack">
      <canvas id="connections" is="wbhb-rack-connections"></canvas>
      <div id="sources"></div>
      <div id="transforms"></div>
      <div id="destinations"></div>
    
    <script type="module">
      import {Scheduler, CONTROL_CODES as SCHEDULER_CONTROL_CODES} from './lib/scheduler/scheduler.mjs';
      import {Metronome} from './lib/sequencer/metronome.mjs';
      import {ItemDB} from './lib/sequencer/items/ItemDB.mjs';
      import {SequencerItem} from './lib/sequencer/items/SequencerItem.mjs';
      import {SectionItem} from './lib/sequencer/items/SectionItem.mjs';
      import {ControlCode, ControlItem} from './lib/sequencer/items/ControlItem.mjs';
      import {PromptItem} from './lib/sequencer/items/PromptItem.mjs';
      import {CachedAudioItem} from './lib/sequencer/items/CachedAudioItem.mjs';
      import {ChordItem} from './lib/sequencer/items/ChordItem.mjs';
      import {MIDIItem} from './lib/sequencer/items/MIDIItem.mjs';
      import {MIDITupleItem} from './lib/sequencer/items/MIDITupleItem.mjs';
      import {TimeSignature} from './lib/util/timeSignature.mjs';
      import {Sequencer} from './lib/sequencer/sequencer.mjs';
      import {MIDISequencer} from './lib/sequencer/MIDISequencer.mjs';
      import {Chord} from './lib/util/chords.mjs';
      import {Length} from './lib/util/length.mjs';
      import {MIDI} from './lib/util/midi.mjs';
      import {MIDIRemap} from './lib/util/midiRemap.mjs';
      import {MainOut} from './lib/instrument/MainOut.mjs';
      import {DrumKit} from './lib/instrument/DrumKit.mjs';
      import {Prompts} from './lib/instrument/Prompts.mjs';
      import {SynthInstrument as Synth} from './lib/instrument/SynthInstrument.mjs';
      import {Hammond} from './lib/instrument/Hammond.mjs';
      import {UserMedia} from './lib/rack/UserMedia.mjs';
      import {Recorder} from './lib/rack/recorder.mjs';
      import {Playback} from './lib/rack/playback.mjs';
      import {Alesis_V25} from './lib/rack/Alesis_V25.mjs';
      import {Octaver} from './lib/rack/Octaver.mjs';
      import {WBHBButton} from './lib/ui/wbhb-button.mjs';
      import {WBHBRackItem} from './lib/ui/wbhb-rack-item.mjs';
      
      const AudioContext = window.AudioContext || window.webkitAudioContext;

      if (!AudioContext) {
        throw new Error("WebAudio not supported");
      }
      
      const metronome = new Metronome();
      const midiSequencer = new MIDISequencer();
      const promptSequencer = new Sequencer();
      
      const kit = await fetch('static/audio/drums/CO/init.json').then(response => response.json()).then(DrumKit.create).then((kit) => {kit.midiChannel = 9; return kit}).catch('Error creating drumkit');
      
      kit.name = "Drum Kit: CO";
      
      const metronomeInstrument = await fetch('static/audio/drums/Metronome/init.json').then(response => response.json()).then(DrumKit.create).then((kit) => {kit.midiChannel = -1; return kit}).catch('Error creating metronome');
      
      metronomeInstrument.name = "Metronome";
      
      const promptsInstrument = await fetch('static/audio/prompts/MT.com/en-us/init.json').then(response => response.json()).then(Prompts.create).then((kit) => {kit.midiChannel = -2; return kit}).catch('Error creating prompts');
      
      promptsInstrument.name = "Prompts";
      
      const synth = new Synth();
      synth.midiChannel = 0;
      
      const hammond = new Hammond();
      hammond.midiChannel = 0;//2;
      
      const kick = {
        channel: 9,
        method: MIDI.Channel_Voice,
        command: MIDI.Note_On,
        note: 36,
        velocity: 127
      };
      
      const k1 = await ItemDB.set(new MIDIItem({
        message: kick,
        timings: {
          offset: new Length(0, Length.units.beat)
        }
      }));
      const k2 = await ItemDB.set(new MIDIItem({
        message: kick,
        timings: {
          offset: new Length(1, Length.units.beat)
        }
      }));
      const k3 = await ItemDB.set(new MIDIItem({
        message: kick,
        timings: {
          offset: new Length(2.5, Length.units.beat)
        }
      }));
      const k4 = await ItemDB.set(new MIDIItem({
        message: kick,
        timings: {
          offset: new Length(3, Length.units.beat)
        }
      }));
      
      const kickBar = await ItemDB.set(new SectionItem({
        itemIds: [k1, k2, k3, k4],
        repeats: 0,
        timings: {
          offset: new Length(0, Length.units.beat)
        }
      }));
      
      const s1 = await ItemDB.set(await new MIDITupleItem({
        note: 36,
        channel: 0,
        timings: {
          offset: new Length(0, Length.units.beat),
          length: new Length(1.4, Length.units.beat)
        }
      }));
      
      const s2 = await ItemDB.set(await new MIDITupleItem({
        note: 36,
        channel: 0,
        timings: {
          offset: new Length(1.5, Length.units.beat),
          length: new Length(0.4, Length.units.beat)
        }
      }));
      
      const s3 = await ItemDB.set(await new MIDITupleItem({
        note: 36,
        channel: 0,
        timings: {
          offset: new Length(2, Length.units.beat),
          length: new Length(0.4, Length.units.beat)
        }
      }));
      
      const s4a = await ItemDB.set(await new MIDITupleItem({
        note: 34,
        channel: 0,
        timings: {
          offset: new Length(2.5, Length.units.beat),
          length: new Length(0.9, Length.units.beat)
        }
      }));
      
      const s4b = await ItemDB.set(await new MIDITupleItem({
        note: 37,
        channel: 0,
        timings: {
          offset: new Length(2.5, Length.units.beat),
          length: new Length(0.9, Length.units.beat)
        }
      }));
      
      const s5a = await ItemDB.set(await new MIDITupleItem({
        note: 34,
        channel: 0,
        timings: {
          offset: new Length(3.5, Length.units.beat),
          length: new Length(0.4, Length.units.beat)
        }
      }));
      
      const s5b = await ItemDB.set(await new MIDITupleItem({
        note: 37,
        channel: 0,
        timings: {
          offset: new Length(3.5, Length.units.beat),
          length: new Length(0.4, Length.units.beat)
        }
      }));
      
      const synthLine = await ItemDB.set(new SectionItem({
        itemIds: [
          [s1, s2, s3, s4a, s5a],
          [s1, s2, s3, s4b, s5b]
        ],
        repeats: 0,
        timings: {
          offset: new Length(0, Length.units.beat)
        }
      }));
      
      midiSequencer.items = [];//[[kickBar, synthLine]];
      
      const chorus = await ItemDB.set(new PromptItem({
        prompts: ["Chorus"],
        count: true,
        timings: {
          offset: new Length(2, Length.units.bar)
        }
      }));
      
      
      promptSequencer.items = [[chorus]];
      
      const sequencerEl = document.querySelector('wbhb-sequencer');
      
      sequencerEl.addSequencer(midiSequencer, 'application/x.wbhb.studio.midiitem');
      sequencerEl.addSequencer(promptSequencer, 'application/x.wbhb.studio.promptitem');
      
      const um = new UserMedia();
      const rec = new Recorder();
      const pb = new Playback();
          
      const kitEl = new WBHBButton();
      kitEl.type = "Drum Kit";
      kitEl.name = kit.name;
      
      kit.drums.forEach(async (drum) => {
        const drumEl = new WBHBButton();
        drumEl.type = "Hit";
        drumEl.name = drum.name;
        drumEl.setAttribute('draggable','true');
        
        const itemId = await ItemDB.set(new MIDIItem({
          message: {
            note: DrumKit.getNoteNumber(drum.name),
            channel: 9,
            method: MIDI.Channel_Voice,
            command: MIDI.Note_On,
            velocity: 127
          }
        }));
        
        drumEl.itemId = itemId;
        
        kitEl.appendChild(drumEl);
      });
      
      document.querySelector('wbhb-button[name="Drums"]').appendChild(kitEl);
      
      document.querySelector('wbhb-button[name="Start"]').addEventListener('click', () => {
        
        if (Scheduler.GLOBAL.audioContext.state === 'suspended') {
          Scheduler.GLOBAL.audioContext.resume();
        }
        
        Scheduler.GLOBAL.start();
        
        
        rec.start();
        
        pb.start();
      });
      
      document.querySelector('wbhb-button[name="Save"]').addEventListener('click', async () => {
        
        rec.handle = await showSaveFilePicker({
          types: [{
            description: 'Audio',
            accept: {'audio/x-wbhb-basic': ['.wbhbabasic']},
          }],
          excludeAcceptAllOption: true,
          multiple: false
        });
      });
      
      document.querySelector('wbhb-button[name="Load"]').addEventListener('click', async () => {
        
        
        [pb.handle] = await showOpenFilePicker({
          types: [{
            description: 'Audio',
            accept: {'audio/x-wbhb-basic': ['.wbhbabasic']},
          }],
          excludeAcceptAllOption: true,
          multiple: false
        });
      });
      
      document.querySelector('wbhb-button[name="Stop"]').addEventListener('click', () => {
        let stop = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.STOP});
        Scheduler.GLOBAL.scheduleItem(stop);
        
        rec.stop();
        pb.stop();
      });
      
      document.querySelector('wbhb-adjust-tempo').tempo.addEventListener('change', (e) => {
        let item = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.TEMPO});
        item.payload = document.querySelector('wbhb-adjust-tempo').tempo;
        Scheduler.GLOBAL.scheduleItem(item);
      });
      
      document.querySelectorAll('wbhb-button[type="Time"]').forEach((node) => {
        const parts = node.getAttribute('name').split('/');
        const upper = Number.parseInt(parts[0], 10);
        const lower = Number.parseInt(parts[1], 10);
        if (upper && lower) {
          node.addEventListener('click', () => {
            let item = new ControlItem({timings: {immediate: true}, controlCode: SCHEDULER_CONTROL_CODES.TIME_SIGNATURE});
            item.payload = new TimeSignature(upper, lower);
            Scheduler.GLOBAL.dispatchEvent(item);
          });
        }
      });
      
      document.querySelectorAll('wbhb-button[type="Prompt"]').forEach((node) => {
        const name = node.getAttribute('name');
        node.addEventListener('click', () => {
          let item = new PromptItem({timings: {immediate: true}, count: true});
          item.add(name);
          Scheduler.GLOBAL.dispatchEvent(item);
        });
      });
      
      document.querySelectorAll('wbhb-button[name="Chords"] wbhb-button:not([type="More"]):not([type="Modifier"])').forEach((node) => {
        const name = node.getAttribute('name');
        const type = node.getAttribute('type');
        
        let item = new ChordItem({timings: {length: {unit: 'beat', value: 1}}});
        let chord = new Chord(name);
        chord = chord.setQuality(type);
        item.chord = chord;
        node.item = item;
        
        node.addEventListener('click', () => {
          let item = new ChordItem({...node.item, ...{timings: {immediate: true}}});
          Scheduler.GLOBAL.dispatchEvent(item);
        });
      });
      
      document.querySelectorAll('wbhb-button[type="Prompt"]').forEach((node) => {
        const name = node.getAttribute('name');
        const type = node.getAttribute('type');
        
        let item = new PromptItem({timings: {length: {unit: 'beat', value: 1}}});
        node.item = item;
        
        node.addEventListener('click', () => {
          let item = new PromptItem({...node.item, ...{timings: {immediate: true}}});
          Scheduler.GLOBAL.dispatchEvent(item);
        });
      });
      
      document.querySelectorAll('wbhb-button[type="Hit"]').forEach((node) => {
        const name = node.getAttribute('name');
        
        let item = new CachedAudioItem({cacheKey: name, timings: {length: {unit: 'beat', value: 1}}});
        node.item = item;
        
        node.addEventListener('click', () => {
          let item = new CachedAudioItem({...node.item, ...{cacheKey: node.item.cacheKey, timings: {immediate: true}}});
          Scheduler.GLOBAL.dispatchEvent(item);
        });
      });
      
      Scheduler.GLOBAL.addEventListener("nextBar", (e) => {
        
        const sequencer = document.querySelector("wbhb-sequencer");
        
        sequencer.currentBar = e.barNumber;
      });
      
      const octaver = new Octaver();
      
      const mainOut = new MainOut();
      
      const rackItems = [
        synth,
        hammond,
        Alesis_V25,
        kit,
        metronomeInstrument,
        promptsInstrument,
        octaver,
        mainOut,
        um,
        rec,
        pb
      ];
      
      rackItems.forEach((item) => {
        const el = new WBHBRackItem(item);
        if (item.isSource) {
          document.querySelector('#rack #sources').appendChild(el)
        }
        if (item.isTransform) {
          document.querySelector('#rack #transforms').appendChild(el)
        }
        if (item.isDestination) {
          document.querySelector('#rack #destinations').appendChild(el)
        }
      });
      
      const canvasEl = document.querySelector('#rack #connections');
      
      canvasEl.connect('Alesis V25', 'MIDI Out', 'Octaver', 'MIDI In');
      canvasEl.connect('Alesis V25', 'MIDI Out', 'Hammond Organ', 'MIDI In');
      canvasEl.connect('Alesis V25', 'MIDI Out', 'Drum Kit: CO', "MIDI In");
      
      canvasEl.connect('Octaver', 'MIDI Out', 'Simple Synth', 'MIDI In');
      
      canvasEl.connect('Simple Synth', 'Main Out', 'Main Out', 'Audio In');
      canvasEl.connect('Hammond Organ', 'Main Out', 'Main Out', 'Audio In');
      canvasEl.connect('Drum Kit: CO', 'Main Out', 'Main Out', 'Audio In');
      canvasEl.connect('Metronome', 'Main Out', 'Main Out', 'Audio In');
      canvasEl.connect('Prompts', 'Main Out', 'Main Out', 'Audio In');
      canvasEl.connect('Playback', 'Main Out', 'Main Out', 'Audio In');
      
      canvasEl.connect('User Media', 'Main Out', 'Recorder', 'Audio In');
      
      canvasEl.connect('Alesis V25', 'Encoder 1', 'Hammond Organ', 'Drawbar 16');
      canvasEl.connect('Alesis V25', 'Encoder 2', 'Hammond Organ', 'Drawbar 5 1/3');
      canvasEl.connect('Alesis V25', 'Encoder 3', 'Hammond Organ', 'Drawbar 2 2/3');
      canvasEl.connect('Alesis V25', 'Encoder 4', 'Hammond Organ', 'Drawbar 2');
      
      canvasEl.connect('Alesis V25', 'Encoder 1', 'Simple Synth', "Attack");
      canvasEl.connect('Alesis V25', 'Encoder 2', 'Simple Synth', "Decay");
      canvasEl.connect('Alesis V25', 'Encoder 3', 'Simple Synth', "Sustain");
      canvasEl.connect('Alesis V25', 'Encoder 4', 'Simple Synth', "Release");
      canvasEl.connect('Alesis V25', 'Pitch Wheel', 'Simple Synth', "Detune");
      
      
      canvasEl.drawConnections();
      
    </script>
    
    <script type="module">
      const firebaseConfig = {
        apiKey: "AIzaSyANXxQRbPcrMxiWWRpttD6maRtE6u0mhpw",
        authDomain: "wbhb-studio.firebaseapp.com",
        projectId: "wbhb-studio",
        storageBucket: "wbhb-studio.appspot.com",
        messagingSenderId: "776527637044",
        appId: "1:776527637044:web:4dfcffc68fdbf03dc37861",
        measurementId: "G-ZH77D4F2FF"
      };

      firebase.initializeApp(firebaseConfig);
    </script>
  </body>
</html>